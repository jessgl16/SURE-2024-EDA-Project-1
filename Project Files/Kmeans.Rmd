---
title: "K-means clustering"
author: "Dennis Campoverde-Lema"
date: "2024-06-10"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Load necessary libraries and Data
```{r}

library(tidyverse)
library(cluster)
library(factoextra)



hospital_data <- read_csv("https://raw.githubusercontent.com/36-SURE/36-SURE.github.io/main/data/hospitals.csv")

glimpse(hospital_data)

```


```{r}
hospital_data <- hospital_data |> 
  mutate(across(where(is.numeric), ~na_if(.x, 0))) |> 
  drop_na()

data_to_cluster <- hospital_data |> 
  select('Procedure.Heart Attack.Cost', 'Procedure.Heart Failure.Cost', Procedure.Pneumonia.Cost, 'Procedure.Hip Knee.Cost')

```


```{r}

scaled_data <- scale(data_to_cluster)

dissimilarity_matrix <- dist(scaled_data)

hc_complete <- hclust(dissimilarity_matrix, method = "complete")


```

hierachy clusters
```{r}
plot(hc_complete, main = "Dendrogram for Complete Linkage")

clusters <- cutree(hc_complete, k = 5) # You can adjust 'k' based on the dendrogram

hospital_data$Cluster <- as.factor(clusters)


```


```{r}
ggplot(hospital_data, aes(x = 'Procedure.Heart.Attack Cost', y = 'Procedure.Heart.Failure Cost', color = Cluster)) +
  geom_point(alpha = 0.6, size = 4) +
  theme_minimal() +
  ggtitle("Cluster Visualization for Hospital Data") +
  scale_color_manual(values = rainbow(length(unique(clusters))))
```

#Performing K means
```{r}
set.seed(123)

kmeans_result <- kmeans(data_to_cluster, centers = 5, nstart = 25)  

hospital_data$Cluster <- factor(kmeans_result$cluster)
```

visualize clusters
```{r}
fviz_cluster(kmeans_result, data = data_to_cluster)

```

# Silhouette analysis
```{r}

silhouette_scores <- silhouette(kmeans_result$cluster, dist(data_to_cluster))
fviz_silhouette(silhouette_scores)

```

